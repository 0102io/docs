
<!doctype html>
<html lang="en" class="no-js">
  <head>
    
      <meta charset="utf-8">
      <meta name="viewport" content="width=device-width,initial-scale=1">
      
      
      
        <link rel="canonical" href="https://docs.0102.io/fwdocs/protocol/">
      
      
        <link rel="prev" href="../">
      
      
        <link rel="next" href="../compiling/">
      
      
      <link rel="icon" href="../../assets/images/favicon.png">
      <meta name="generator" content="mkdocs-1.6.0, mkdocs-material-9.5.29">
    
    
      
        <title>Communication Protocol - TappyTap Documentation</title>
      
    
    
      <link rel="stylesheet" href="../../assets/stylesheets/main.76a95c52.min.css">
      
        
        <link rel="stylesheet" href="../../assets/stylesheets/palette.06af60db.min.css">
      
      


    
    
      
    
    
      
        
        
        <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
        <link rel="stylesheet" href="https://fonts.googleapis.com/css?family=Roboto:300,300i,400,400i,700,700i%7CRoboto+Mono:400,400i,700,700i&display=fallback">
        <style>:root{--md-text-font:"Roboto";--md-code-font:"Roboto Mono"}</style>
      
    
    
      <link rel="stylesheet" href="../../stylesheets/extra.css">
    
    <script>__md_scope=new URL("../..",location),__md_hash=e=>[...e].reduce((e,_)=>(e<<5)-e+_.charCodeAt(0),0),__md_get=(e,_=localStorage,t=__md_scope)=>JSON.parse(_.getItem(t.pathname+"."+e)),__md_set=(e,_,t=localStorage,a=__md_scope)=>{try{t.setItem(a.pathname+"."+e,JSON.stringify(_))}catch(e){}}</script>
    
      

    
    
    
  </head>
  
  
    
    
      
    
    
    
    
    <body dir="ltr" data-md-color-scheme="slate" data-md-color-primary="indigo" data-md-color-accent="indigo">
  
    
    <input class="md-toggle" data-md-toggle="drawer" type="checkbox" id="__drawer" autocomplete="off">
    <input class="md-toggle" data-md-toggle="search" type="checkbox" id="__search" autocomplete="off">
    <label class="md-overlay" for="__drawer"></label>
    <div data-md-component="skip">
      
        
        <a href="#communication-protocol-for-client-device-and-tappytap-controller" class="md-skip">
          Skip to content
        </a>
      
    </div>
    <div data-md-component="announce">
      
    </div>
    
    
      

  

<header class="md-header md-header--shadow" data-md-component="header">
  <nav class="md-header__inner md-grid" aria-label="Header">
    <a href="../.." title="TappyTap Documentation" class="md-header__button md-logo" aria-label="TappyTap Documentation" data-md-component="logo">
      
  
  <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M12 8a3 3 0 0 0 3-3 3 3 0 0 0-3-3 3 3 0 0 0-3 3 3 3 0 0 0 3 3m0 3.54C9.64 9.35 6.5 8 3 8v11c3.5 0 6.64 1.35 9 3.54 2.36-2.19 5.5-3.54 9-3.54V8c-3.5 0-6.64 1.35-9 3.54Z"/></svg>

    </a>
    <label class="md-header__button md-icon" for="__drawer">
      
      <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M3 6h18v2H3V6m0 5h18v2H3v-2m0 5h18v2H3v-2Z"/></svg>
    </label>
    <div class="md-header__title" data-md-component="header-title">
      <div class="md-header__ellipsis">
        <div class="md-header__topic">
          <span class="md-ellipsis">
            TappyTap Documentation
          </span>
        </div>
        <div class="md-header__topic" data-md-component="header-topic">
          <span class="md-ellipsis">
            
              Communication Protocol
            
          </span>
        </div>
      </div>
    </div>
    
      
        <form class="md-header__option" data-md-component="palette">
  
    
    
    
    <input class="md-option" data-md-color-media="(prefers-color-scheme: dark)" data-md-color-scheme="slate" data-md-color-primary="indigo" data-md-color-accent="indigo"  aria-label="Switch to light mode"  type="radio" name="__palette" id="__palette_0">
    
      <label class="md-header__button md-icon" title="Switch to light mode" for="__palette_1" hidden>
        <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M12 18c-.89 0-1.74-.2-2.5-.55C11.56 16.5 13 14.42 13 12c0-2.42-1.44-4.5-3.5-5.45C10.26 6.2 11.11 6 12 6a6 6 0 0 1 6 6 6 6 0 0 1-6 6m8-9.31V4h-4.69L12 .69 8.69 4H4v4.69L.69 12 4 15.31V20h4.69L12 23.31 15.31 20H20v-4.69L23.31 12 20 8.69Z"/></svg>
      </label>
    
  
    
    
    
    <input class="md-option" data-md-color-media="(prefers-color-scheme: light)" data-md-color-scheme="default" data-md-color-primary="indigo" data-md-color-accent="indigo"  aria-label="Switch to dark mode"  type="radio" name="__palette" id="__palette_1">
    
      <label class="md-header__button md-icon" title="Switch to dark mode" for="__palette_0" hidden>
        <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M12 8a4 4 0 0 0-4 4 4 4 0 0 0 4 4 4 4 0 0 0 4-4 4 4 0 0 0-4-4m0 10a6 6 0 0 1-6-6 6 6 0 0 1 6-6 6 6 0 0 1 6 6 6 6 0 0 1-6 6m8-9.31V4h-4.69L12 .69 8.69 4H4v4.69L.69 12 4 15.31V20h4.69L12 23.31 15.31 20H20v-4.69L23.31 12 20 8.69Z"/></svg>
      </label>
    
  
</form>
      
    
    
      <script>var media,input,key,value,palette=__md_get("__palette");if(palette&&palette.color){"(prefers-color-scheme)"===palette.color.media&&(media=matchMedia("(prefers-color-scheme: light)"),input=document.querySelector(media.matches?"[data-md-color-media='(prefers-color-scheme: light)']":"[data-md-color-media='(prefers-color-scheme: dark)']"),palette.color.media=input.getAttribute("data-md-color-media"),palette.color.scheme=input.getAttribute("data-md-color-scheme"),palette.color.primary=input.getAttribute("data-md-color-primary"),palette.color.accent=input.getAttribute("data-md-color-accent"));for([key,value]of Object.entries(palette.color))document.body.setAttribute("data-md-color-"+key,value)}</script>
    
    
    
      <label class="md-header__button md-icon" for="__search">
        
        <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M9.5 3A6.5 6.5 0 0 1 16 9.5c0 1.61-.59 3.09-1.56 4.23l.27.27h.79l5 5-1.5 1.5-5-5v-.79l-.27-.27A6.516 6.516 0 0 1 9.5 16 6.5 6.5 0 0 1 3 9.5 6.5 6.5 0 0 1 9.5 3m0 2C7 5 5 7 5 9.5S7 14 9.5 14 14 12 14 9.5 12 5 9.5 5Z"/></svg>
      </label>
      <div class="md-search" data-md-component="search" role="dialog">
  <label class="md-search__overlay" for="__search"></label>
  <div class="md-search__inner" role="search">
    <form class="md-search__form" name="search">
      <input type="text" class="md-search__input" name="query" aria-label="Search" placeholder="Search" autocapitalize="off" autocorrect="off" autocomplete="off" spellcheck="false" data-md-component="search-query" required>
      <label class="md-search__icon md-icon" for="__search">
        
        <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M9.5 3A6.5 6.5 0 0 1 16 9.5c0 1.61-.59 3.09-1.56 4.23l.27.27h.79l5 5-1.5 1.5-5-5v-.79l-.27-.27A6.516 6.516 0 0 1 9.5 16 6.5 6.5 0 0 1 3 9.5 6.5 6.5 0 0 1 9.5 3m0 2C7 5 5 7 5 9.5S7 14 9.5 14 14 12 14 9.5 12 5 9.5 5Z"/></svg>
        
        <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M20 11v2H8l5.5 5.5-1.42 1.42L4.16 12l7.92-7.92L13.5 5.5 8 11h12Z"/></svg>
      </label>
      <nav class="md-search__options" aria-label="Search">
        
        <button type="reset" class="md-search__icon md-icon" title="Clear" aria-label="Clear" tabindex="-1">
          
          <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M19 6.41 17.59 5 12 10.59 6.41 5 5 6.41 10.59 12 5 17.59 6.41 19 12 13.41 17.59 19 19 17.59 13.41 12 19 6.41Z"/></svg>
        </button>
      </nav>
      
    </form>
    <div class="md-search__output">
      <div class="md-search__scrollwrap" tabindex="0" data-md-scrollfix>
        <div class="md-search-result" data-md-component="search-result">
          <div class="md-search-result__meta">
            Initializing search
          </div>
          <ol class="md-search-result__list" role="presentation"></ol>
        </div>
      </div>
    </div>
  </div>
</div>
    
    
      <div class="md-header__source">
        <a href="https://github.com/0102io/testing" title="Go to repository" class="md-source" data-md-component="source">
  <div class="md-source__icon md-icon">
    
    <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 448 512"><!--! Font Awesome Free 6.5.2 by @fontawesome - https://fontawesome.com License - https://fontawesome.com/license/free (Icons: CC BY 4.0, Fonts: SIL OFL 1.1, Code: MIT License) Copyright 2024 Fonticons, Inc.--><path d="M439.55 236.05 244 40.45a28.87 28.87 0 0 0-40.81 0l-40.66 40.63 51.52 51.52c27.06-9.14 52.68 16.77 43.39 43.68l49.66 49.66c34.23-11.8 61.18 31 35.47 56.69-26.49 26.49-70.21-2.87-56-37.34L240.22 199v121.85c25.3 12.54 22.26 41.85 9.08 55a34.34 34.34 0 0 1-48.55 0c-17.57-17.6-11.07-46.91 11.25-56v-123c-20.8-8.51-24.6-30.74-18.64-45L142.57 101 8.45 235.14a28.86 28.86 0 0 0 0 40.81l195.61 195.6a28.86 28.86 0 0 0 40.8 0l194.69-194.69a28.86 28.86 0 0 0 0-40.81z"/></svg>
  </div>
  <div class="md-source__repository">
    GitHub
  </div>
</a>
      </div>
    
  </nav>
  
</header>
    
    <div class="md-container" data-md-component="container">
      
      
        
          
        
      
      <main class="md-main" data-md-component="main">
        <div class="md-main__inner md-grid">
          
            
              
              <div class="md-sidebar md-sidebar--primary" data-md-component="sidebar" data-md-type="navigation" >
                <div class="md-sidebar__scrollwrap">
                  <div class="md-sidebar__inner">
                    



<nav class="md-nav md-nav--primary" aria-label="Navigation" data-md-level="0">
  <label class="md-nav__title" for="__drawer">
    <a href="../.." title="TappyTap Documentation" class="md-nav__button md-logo" aria-label="TappyTap Documentation" data-md-component="logo">
      
  
  <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M12 8a3 3 0 0 0 3-3 3 3 0 0 0-3-3 3 3 0 0 0-3 3 3 3 0 0 0 3 3m0 3.54C9.64 9.35 6.5 8 3 8v11c3.5 0 6.64 1.35 9 3.54 2.36-2.19 5.5-3.54 9-3.54V8c-3.5 0-6.64 1.35-9 3.54Z"/></svg>

    </a>
    TappyTap Documentation
  </label>
  
    <div class="md-nav__source">
      <a href="https://github.com/0102io/testing" title="Go to repository" class="md-source" data-md-component="source">
  <div class="md-source__icon md-icon">
    
    <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 448 512"><!--! Font Awesome Free 6.5.2 by @fontawesome - https://fontawesome.com License - https://fontawesome.com/license/free (Icons: CC BY 4.0, Fonts: SIL OFL 1.1, Code: MIT License) Copyright 2024 Fonticons, Inc.--><path d="M439.55 236.05 244 40.45a28.87 28.87 0 0 0-40.81 0l-40.66 40.63 51.52 51.52c27.06-9.14 52.68 16.77 43.39 43.68l49.66 49.66c34.23-11.8 61.18 31 35.47 56.69-26.49 26.49-70.21-2.87-56-37.34L240.22 199v121.85c25.3 12.54 22.26 41.85 9.08 55a34.34 34.34 0 0 1-48.55 0c-17.57-17.6-11.07-46.91 11.25-56v-123c-20.8-8.51-24.6-30.74-18.64-45L142.57 101 8.45 235.14a28.86 28.86 0 0 0 0 40.81l195.61 195.6a28.86 28.86 0 0 0 40.8 0l194.69-194.69a28.86 28.86 0 0 0 0-40.81z"/></svg>
  </div>
  <div class="md-source__repository">
    GitHub
  </div>
</a>
    </div>
  
  <ul class="md-nav__list" data-md-scrollfix>
    
      
      
  
  
  
  
    <li class="md-nav__item">
      <a href="../.." class="md-nav__link">
        
  
  <span class="md-ellipsis">
    Home
  </span>
  

      </a>
    </li>
  

    
      
      
  
  
  
  
    <li class="md-nav__item">
      <a href="../../about/" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    About
  </span>
  

      </a>
    </li>
  

    
      
      
  
  
  
  
    <li class="md-nav__item">
      <a href="../../hwdocs/" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    Hardware
  </span>
  

      </a>
    </li>
  

    
      
      
  
  
  
  
    <li class="md-nav__item">
      <a href="../../swdocs/" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    Software
  </span>
  

      </a>
    </li>
  

    
      
      
  
  
    
  
  
  
    
    
    
    
    <li class="md-nav__item md-nav__item--active md-nav__item--nested">
      
        
        
        <input class="md-nav__toggle md-toggle " type="checkbox" id="__nav_5" checked>
        
          
          <label class="md-nav__link" for="__nav_5" id="__nav_5_label" tabindex="0">
            
  
  <span class="md-ellipsis">
    Firmware
  </span>
  

            <span class="md-nav__icon md-icon"></span>
          </label>
        
        <nav class="md-nav" data-md-level="1" aria-labelledby="__nav_5_label" aria-expanded="true">
          <label class="md-nav__title" for="__nav_5">
            <span class="md-nav__icon md-icon"></span>
            Firmware
          </label>
          <ul class="md-nav__list" data-md-scrollfix>
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    Overview
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
    
  
  
  
    <li class="md-nav__item md-nav__item--active">
      
      <input class="md-nav__toggle md-toggle" type="checkbox" id="__toc">
      
      
        
      
      
        <label class="md-nav__link md-nav__link--active" for="__toc">
          
  
  <span class="md-ellipsis">
    Communication Protocol
  </span>
  

          <span class="md-nav__icon md-icon"></span>
        </label>
      
      <a href="./" class="md-nav__link md-nav__link--active">
        
  
  <span class="md-ellipsis">
    Communication Protocol
  </span>
  

      </a>
      
        

<nav class="md-nav md-nav--secondary" aria-label="Table of contents">
  
  
  
    
  
  
    <label class="md-nav__title" for="__toc">
      <span class="md-nav__icon md-icon"></span>
      Table of contents
    </label>
    <ul class="md-nav__list" data-md-component="toc" data-md-scrollfix>
      
        <li class="md-nav__item">
  <a href="#connecting-to-the-controller" class="md-nav__link">
    <span class="md-ellipsis">
      Connecting to the Controller
    </span>
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#sending-messages-to-the-controller" class="md-nav__link">
    <span class="md-ellipsis">
      Sending Messages to the Controller
    </span>
  </a>
  
    <nav class="md-nav" aria-label="Sending Messages to the Controller">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#sent-message-types-and-structure" class="md-nav__link">
    <span class="md-ellipsis">
      Sent Message Types and Structure
    </span>
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
      
        <li class="md-nav__item">
  <a href="#receiving-messages-from-the-controller" class="md-nav__link">
    <span class="md-ellipsis">
      Receiving Messages from the Controller
    </span>
  </a>
  
    <nav class="md-nav" aria-label="Receiving Messages from the Controller">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#received-message-types-and-structure" class="md-nav__link">
    <span class="md-ellipsis">
      Received Message Types and Structure
    </span>
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
      
    </ul>
  
</nav>
      
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../compiling/" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    Compiling the Controller Firmware
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../controllerfw/" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    Controller Firmware Overview
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../batteryfw/" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    Battery PCB Firmware Overview
  </span>
  

      </a>
    </li>
  

              
            
          </ul>
        </nav>
      
    </li>
  

    
  </ul>
</nav>
                  </div>
                </div>
              </div>
            
            
              
              <div class="md-sidebar md-sidebar--secondary" data-md-component="sidebar" data-md-type="toc" >
                <div class="md-sidebar__scrollwrap">
                  <div class="md-sidebar__inner">
                    

<nav class="md-nav md-nav--secondary" aria-label="Table of contents">
  
  
  
    
  
  
    <label class="md-nav__title" for="__toc">
      <span class="md-nav__icon md-icon"></span>
      Table of contents
    </label>
    <ul class="md-nav__list" data-md-component="toc" data-md-scrollfix>
      
        <li class="md-nav__item">
  <a href="#connecting-to-the-controller" class="md-nav__link">
    <span class="md-ellipsis">
      Connecting to the Controller
    </span>
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#sending-messages-to-the-controller" class="md-nav__link">
    <span class="md-ellipsis">
      Sending Messages to the Controller
    </span>
  </a>
  
    <nav class="md-nav" aria-label="Sending Messages to the Controller">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#sent-message-types-and-structure" class="md-nav__link">
    <span class="md-ellipsis">
      Sent Message Types and Structure
    </span>
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
      
        <li class="md-nav__item">
  <a href="#receiving-messages-from-the-controller" class="md-nav__link">
    <span class="md-ellipsis">
      Receiving Messages from the Controller
    </span>
  </a>
  
    <nav class="md-nav" aria-label="Receiving Messages from the Controller">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#received-message-types-and-structure" class="md-nav__link">
    <span class="md-ellipsis">
      Received Message Types and Structure
    </span>
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
      
    </ul>
  
</nav>
                  </div>
                </div>
              </div>
            
          
          
            <div class="md-content" data-md-component="content">
              <article class="md-content__inner md-typeset">
                
                  

  
    <a href="https://github.com/0102io/docs/edit/main/docs/fwdocs/protocol.md" title="Edit this page" class="md-content__button md-icon">
      
      <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M10 20H6V4h7v5h5v3.1l2-2V8l-6-6H6c-1.1 0-2 .9-2 2v16c0 1.1.9 2 2 2h4v-2m10.2-7c.1 0 .3.1.4.2l1.3 1.3c.2.2.2.6 0 .8l-1 1-2.1-2.1 1-1c.1-.1.2-.2.4-.2m0 3.9L14.1 23H12v-2.1l6.1-6.1 2.1 2.1Z"/></svg>
    </a>
  
  


<h1 id="communication-protocol-for-client-device-and-tappytap-controller">Communication Protocol for Client Device and TappyTap Controller</h1>
<p>This section outlines the communication protocol for a central device to connect to a the TappyTap Controller using Bluetooth 5 (LE). see 'script.js' in the examples folder for an implementation of this protocol.</p>
<h2 id="connecting-to-the-controller">Connecting to the Controller</h2>
<p>The Controller advertises itself as a BLE server with the service UUID <code>4fafc201-1fb5-459e-8fcc-c5c9c331914b</code>. The client device should initiate a scan for BLE devices and look for the one advertising this service UUID. Once found, the client device should establish a connection to the BLE server (the Controller).</p>
<h2 id="sending-messages-to-the-controller">Sending Messages to the Controller</h2>
<p>To send a message from the client device to the Controller, the central device should write to the BLE characteristic with the UUID <code>beb5483e-36e1-4688-b7f5-ea07361b26a8</code>.</p>
<h3 id="sent-message-types-and-structure">Sent Message Types and Structure</h3>
<ul>
<li>
<p><code>TAP_OUT</code>: Byte code <code>1</code>. The message should follow this structure:</p>
<ul>
<li>Byte 0: Message type (<code>1</code>)</li>
<li>Byte 1: idenfication number that is retruned by the controller along with the confirmation when the TAP_OUT sequence is completed. Sending followup TAP_OUT messages will have their contents added to the queue of taps, and the new ID will overwrite the last. Sending an ID of <code>0</code> will cancel an active pattern.</li>
<li>Bytes 2 to n: sets of 6 bytes for each tap in the pattern. The 6 bytes are: 
  | Byte | Description | 
  |---|---|
  | 0-1 | onDuration (MSB first). This is length of time to apply voltage to a coil, in tens of microseconds (i.e. onDuration = 20 --&gt; 200us) |
  | 2-3 | offDuration (MSB first). This is the length of time before the next tap executes, in hundreds of microseconds (i.e. offDuration = 20 --&gt; 2000us) |
  | 4 | Anode ID and output pin. Bits 0-3 are the output pin. Bits 4-5 are the anode ID. Bits 6-7 are unused. Bit 0 is the LSb. |
  | 5 | Cathode ID and output pin. Bits 0-3 are the output pin. Bits 4-5 are the anode ID. Bits 6-7 are unused. Bit 0 is the LSb. |</li>
</ul>
<p>TAP_OUT example:
  | Byte Value | Description |
  |---|---|
  | 0b00000001 | Message type (TAP_OUT)|
  | 0b00000002 | TapoutID = 2 |
  | 0b00000000 | onDuration MSB = 0 |
  | 0b01100100 | onDuration LSB = 100, i.e. 1000us |
  | 0b00000000 | offDuration MSB = 0 |
  | 0b01100100 | offDuration LSB = 100, i.e. 10000us |
  | 0b--010101 | Andode: ID = 1, output pin = 5 |
  | 0b--101001 | Andode: ID = 3, output pin = 9 |</p>
</li>
<li>
<p><code>GET_DEVICE_INFO</code>: Byte code <code>2</code>. Controller returns with <code>DEVICE_INFO</code> message.</p>
</li>
<li>
<p><code>CANCEL_AND_TAP</code>: Byte code <code>3</code>. Clears the queue of taps and then loads the new taps through the same function called by TAP_OUT. This can be used to clear the queue and start a new pattern in 1 BLE pulse.</p>
</li>
<li>
<p><code>UPDATE_STATUS_FREQUENCY</code>: Byte code <code>4</code>. A second byte with the frequency in Hz must be sent. If the requested frequency is above the limit set in the firmware, the maxiumum frequency will be used instead. If 0 is sent, the frequency will be set to 1 Hz.</p>
</li>
<li>
<p><code>CHANGE_DEFAULT_SUBSTRATE</code>: Byte code <code>5</code>. Send with 3 more bytes for <code>substrateType</code> (1 = patch, 2 = palm/glove), <code>substrateVMajor</code>, and <code>substrateVMinor</code>. These values are saved to non-volatile memory and used to set the bluetooth device name. They can be read using <code>GET_DEVICE_INFO</code>.</p>
</li>
</ul>
<h2 id="receiving-messages-from-the-controller">Receiving Messages from the Controller</h2>
<p>The client device should monitor the characteristic with UUID <code>d036e381-fd38-4376-801f-f5d90ba2ca64</code> for notifications from the Controller.</p>
<h3 id="received-message-types-and-structure">Received Message Types and Structure</h3>
<ul>
<li>
<p><code>STATUS_UPDATE</code>: Byte code <code>1</code>. This message is sent to the client device at a user settable frequency. The returned bytes are as follows; unless otherwise noted, multi-byte values are all MSB first</p>
<table>
<thead>
<tr>
<th>Byte</th>
<th>Description</th>
</tr>
</thead>
<tbody>
<tr>
<td>0</td>
<td>Message code (STATUS_UPDATE)</td>
</tr>
<tr>
<td>1</td>
<td>Battery percent</td>
</tr>
<tr>
<td>2</td>
<td>Last received tapout id</td>
</tr>
<tr>
<td>3-4</td>
<td>Headroom / free space in the queue</td>
</tr>
<tr>
<td>5-8</td>
<td>IMU accel X (multiplied by 1000)</td>
</tr>
<tr>
<td>9-12</td>
<td>IMU accel Y (multiplied by 1000)</td>
</tr>
<tr>
<td>13-16</td>
<td>IMU accel Z (multiplied by 1000)</td>
</tr>
<tr>
<td>17-20</td>
<td>IMU gyro X (multiplied by 1000)</td>
</tr>
<tr>
<td>21-24</td>
<td>IMU gyro Y (multiplied by 1000)</td>
</tr>
<tr>
<td>25-28</td>
<td>IMU gyro Z (multiplied by 1000)</td>
</tr>
<tr>
<td>29-30</td>
<td>IMU temperature (multiplied by 10)</td>
</tr>
<tr>
<td><!-- note: when reading from the status update function, remember that an additional byte is added (the message code) --></td>
<td></td>
</tr>
</tbody>
</table>
</li>
<li>
<p><code>WARNING</code>: Byte code <code>2</code>. This message contains warnings, and it is sent when they occur (i.e not regularly like the status updates). This message may contain multiple error codes each with data of different lengths. The codes and types of data are as follows:</p>
</li>
<li><code>INVALID_MSG_TYPE</code>: Byte code <code>51</code>, + 1 data byte. The byte code is followed by the 1-byte code of the invalid message type that was received. </li>
<li><code>INCORRECT_MSG_SIZE</code>: Byte code <code>52</code>, + 0 data bytes. This warning is sent when the last received message was incorrectly sized (e.g. a TAP_OUT message might be missing a setting or col index, etc.).</li>
<li><code>PARAM_OOB</code>: Byte code <code>53</code>, + 2 data bytes. The byte code is followed by 2 bytes that are the MSB and LSB of the out of bounds parameter from the last <code>TAP_OUT</code> message that was last received. If multiple parameters are OOB, only the first 10 are sent as warnings. Row and column indicies that are OOB are replaced with "empty tap" indicies, which will make the controller pause for the onDuration to keep the pattern cadence intact. If the warning is given for an onDuration parameter (i.e. above the limit), the controller replaces the sent parameter with the maximum onDuration value defined in the firmware. Note that the returned index does not count the message type or tapout id bytes.</li>
<li><code>OTA_TIMEOUT</code>: Byte code <code>61</code>, + 0 data bytes. This warning is sent when the controller receives an OTA upload request but the user doesn't press the 'interact button' before the timeout period.</li>
<li><code>QUEUE_FULL</code>: Byte code <code>62</code>, + 2 data bytes. This warning is sent when the last TAP_OUT message contained more taps than could be fit into the queue. The byte code is followed by 2 bytes for the MSB and LSB of the index of the first tap that didn't fit into the queue.</li>
<li><code>BOARD_OVERHEAT</code>: Byte code <code>63</code>, + 1 data byte. This warning is sent when the board temperature changes to a different "level", with level 0 being normal and higher levels being increasingly hot. For each level above 0, the controller attenuates the tap onDuration while keeping the pattern cadence the same. The level is included as a single byte after the warning code.</li>
<li><code>OVERTAP</code>: Byte code <code>64</code>, + 2 data bytes. This warning is sent when an individual tapper is being driven at too high of a duty cycle. The following 2 bytes are the tapper's row and column indices. Similar to <code>BOARD_OVERHEAT</code>, the controller attenuates the onDuration of the taps on an over-tapped actuator, while keeping the cadence the same (by pausing without tapping).</li>
<li>
<p><code>HBRIDGE_DIAGNOSTIC_ERRORS</code>: Byte code <code>65</code>, + 2 data bytes. This warning is sent when an H-bridge driver chip reports a warning while it is being turned on or off for a tap. The first additional byte of data is the ID of the H-bridge chip that reported errors. The second data byte is a set of warning/error flags listed below. These warnings are described in the driver's <a href="https://www.monolithicpower.com/en/documentview/productdocument/index/version/2/document_type/Datasheet/lang/en/sku/MP6527GF/document_id/10142/">datasheet</a>. A warning message is only sent once when the error byte has changed.</p>
<p>x (MSB) | x | OC_7TO10_ERROR | OC_1TO6_ERROR | OLD_7TO10_ERROR | OLD_1TO6_ERROR | PSF_ERROR | TW_WARNING (LSB)</p>
</li>
<li>
<p><code>HBRIDGE_DISABLED</code>: Byte code <code>66</code>, + 0 data bytes. This warning is sent when an H-bridge disbaled event is detected. This can happen when either the overcurrent or watchdog protection circuits pull the H-bridge enable pin low, which disables the H-bridge outputs until they are written to again by the microcontroller. The overcurrent circuit trips if an output has been on for too long (200-400ms). The watchdog timer trips if the microcontroller hasn't pinged it within its timeout period.</p>
</li>
<li>
<p><code>DEVICE_INFO</code>: Byte code <code>3</code>. This message contains configuration information that usually only needs to be passed to the client device once. The returned bytes are as follows; unless otherwise noted, multi-byte values are all MSB first</p>
<table>
<thead>
<tr>
<th>Byte</th>
<th>Description</th>
</tr>
</thead>
<tbody>
<tr>
<td>0</td>
<td>Message code (DEVICE_INFO)</td>
</tr>
<tr>
<td>1</td>
<td>Serial Number (MAC Address) first octet</td>
</tr>
<tr>
<td>2</td>
<td>Serial Number (MAC Address) second octet</td>
</tr>
<tr>
<td>3</td>
<td>Serial Number (MAC Address) third octet</td>
</tr>
<tr>
<td>4</td>
<td>Serial Number (MAC Address) fourth octet</td>
</tr>
<tr>
<td>5</td>
<td>Serial Number (MAC Address) fifth octet</td>
</tr>
<tr>
<td>6</td>
<td>Serial Number (MAC Address) sixth octet</td>
</tr>
<tr>
<td>7</td>
<td>Controller hardware version (major)</td>
</tr>
<tr>
<td>8</td>
<td>Controller hardware version (minor)</td>
</tr>
<tr>
<td>9</td>
<td>Firmware version (major)</td>
</tr>
<tr>
<td>10</td>
<td>Firmware version (minor)</td>
</tr>
<tr>
<td>11</td>
<td>Firmware version (patch)</td>
</tr>
<tr>
<td>12</td>
<td>Connected board type (0 for swatch, 1 for palm)</td>
</tr>
<tr>
<td>13</td>
<td>Connected board version (major)</td>
</tr>
<tr>
<td>14</td>
<td>Connected board version (minor)</td>
</tr>
<tr>
<td>15-16</td>
<td>Maximum tap on duration (hundredths of a ms)</td>
</tr>
</tbody>
</table>
</li>
</ul>












                
              </article>
            </div>
          
          
  <script>var tabs=__md_get("__tabs");if(Array.isArray(tabs))e:for(var set of document.querySelectorAll(".tabbed-set")){var tab,labels=set.querySelector(".tabbed-labels");for(tab of tabs)for(var label of labels.getElementsByTagName("label"))if(label.innerText.trim()===tab){var input=document.getElementById(label.htmlFor);input.checked=!0;continue e}}</script>

<script>var target=document.getElementById(location.hash.slice(1));target&&target.name&&(target.checked=target.name.startsWith("__tabbed_"))</script>
        </div>
        
      </main>
      
        <footer class="md-footer">
  
    
      
      <nav class="md-footer__inner md-grid" aria-label="Footer" >
        
          
          <a href="../" class="md-footer__link md-footer__link--prev" aria-label="Previous: Overview">
            <div class="md-footer__button md-icon">
              
              <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M20 11v2H8l5.5 5.5-1.42 1.42L4.16 12l7.92-7.92L13.5 5.5 8 11h12Z"/></svg>
            </div>
            <div class="md-footer__title">
              <span class="md-footer__direction">
                Previous
              </span>
              <div class="md-ellipsis">
                Overview
              </div>
            </div>
          </a>
        
        
          
          <a href="../compiling/" class="md-footer__link md-footer__link--next" aria-label="Next: Compiling the Controller Firmware">
            <div class="md-footer__title">
              <span class="md-footer__direction">
                Next
              </span>
              <div class="md-ellipsis">
                Compiling the Controller Firmware
              </div>
            </div>
            <div class="md-footer__button md-icon">
              
              <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M4 11v2h12l-5.5 5.5 1.42 1.42L19.84 12l-7.92-7.92L10.5 5.5 16 11H4Z"/></svg>
            </div>
          </a>
        
      </nav>
    
  
  <div class="md-footer-meta md-typeset">
    <div class="md-footer-meta__inner md-grid">
      <div class="md-copyright">
  
  
    Made with
    <a href="https://squidfunk.github.io/mkdocs-material/" target="_blank" rel="noopener">
      Material for MkDocs
    </a>
  
</div>
      
    </div>
  </div>
</footer>
      
    </div>
    <div class="md-dialog" data-md-component="dialog">
      <div class="md-dialog__inner md-typeset"></div>
    </div>
    
    
    <script id="__config" type="application/json">{"base": "../..", "features": ["navigation.footer", "navigation.tracking", "content.tabs.link", "content.action.edit"], "search": "../../assets/javascripts/workers/search.b8dbb3d2.min.js", "translations": {"clipboard.copied": "Copied to clipboard", "clipboard.copy": "Copy to clipboard", "search.result.more.one": "1 more on this page", "search.result.more.other": "# more on this page", "search.result.none": "No matching documents", "search.result.one": "1 matching document", "search.result.other": "# matching documents", "search.result.placeholder": "Type to start searching", "search.result.term.missing": "Missing", "select.version": "Select version"}}</script>
    
    
      <script src="../../assets/javascripts/bundle.fe8b6f2b.min.js"></script>
      
    
  </body>
</html>